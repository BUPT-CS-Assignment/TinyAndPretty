<!DOCTYPE html>
<link href="favicon.ico" rel="shortcut icon">
<html>
    <head>
        <title>Tiny And Pretty</title>
    </head>
    <body>
        <h1>TAP Sign Up</h1>
        <h2>    
            <form>
                UserID:<br> 
                <input type = "text" id = "userid" style = "width: 160px; height: 16px;">
                <br>
                Password:<br> 
                <input type = "password" id = "passwd" style = "width: 160px; height: 16px;">
                <br>
                Password Confirm:<br> 
                <input type = "password" id = "passwd_cfm" style = "width: 160px; height: 16px;">
                <br>
                <button type = "button" onclick="SendVal() ">Sign Up</button>    
                <br>
               
            </form>
        </h2>
        <h3>
            Have an account already?
            <button type = "button" onclick="window.open('http://'+location.host+'/signin','_self');">Sign In</button> 
        </h3>
        <br>
        <hr align=center width="400px" size=2 style = "float:left">
        <br>
        <h3>
            For More Infomation:
            <br>
            <button id="sql" onclick="window.open('http://'+location.host+'/sql')">TAP SQL Test</button>
	        <button id="tap" onclick="window.open('https://github.com/NoUITeam/TinyAndPretty.git')">TAP Git Repo</button>
            <button id="nedb" onclick="window.open('https://github.com/Jianxff/NEDB.git')">NEDB Git Repo</button>
        </h3>

        <script>
            function SendVal(){
                var xhttp = new XMLHttpRequest();
                var ROOT = "http://" + location.host;
                /* Get Input Value */
                var id = document.getElementById("userid").value;
                var pwd = document.getElementById("passwd").value + "";
                var cfm = document.getElementById("passwd_cfm").value + "";
                /* Check Valid */
                if(id == "" || pwd == ""){
                    alert("Empty Input!");
                    return;
                }
                if(Number(id)!=id || id.length!=10 || Number(id)>2147483647){
                    alert("Invalid UserID! Range From 1000000000 to 2147483647.");
                    return;
                }
                if(pwd.length>16){
                    alert("Password Length Overflow!");
                    return;
                }
                if(pwd != cfm){
                    alert("Passwords Not Match!");
                    return;
                }
                /* Action */
                xhttp.onreadystatechange = function(){
                    if(this.readyState == 4){
                        if(this.status == 200){
                            var rec = this.responseText;
                            console.log(rec);
                            /* Get Response Info */                        
                            var pos1 =rec.indexOf("?");
                            /* Response Str Split */
                            var code = rec.substring(0,pos1);
                            var msg = rec.substring(pos1+1);
                            /* Info Check */
                            if(code != "0"){
                                alert(msg);
                                return;
                            }
                            alert("Sign Up Success!");
                            window.open(ROOT+"/signin",'_self');
                        }else if(xhttp.status == 400){
                            alert("BAD_REQUEST");
                        }
                    }
                };
                xhttp.open("POST",ROOT + "/signup",true);
                xhttp.setRequestHeader("Content-type", "multipart/form-data");
                xhttp.setRequestHeader("Userid",id);
                xhttp.setRequestHeader("Passwd",pwd);
                xhttp.setRequestHeader("Function","signup");
                xhttp.send();
            }
        </script>
    </body>
</html>
